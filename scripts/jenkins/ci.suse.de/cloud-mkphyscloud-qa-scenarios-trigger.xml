<?xml version="1.0" encoding="UTF-8"?>
<matrix-project plugin="matrix-project@1.6">
  <actions/>
  <description>Used for deploying all qa scenario files sequentialy located in github.com/suse-cloud/automation repo.&#13;
The hardware used is qa2.</description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <com.sonyericsson.jenkins.plugins.bfa.model.ScannerJobProperty plugin="build-failure-analyzer@">
      <doNotScan>false</doNotScan>
    </com.sonyericsson.jenkins.plugins.bfa.model.ScannerJobProperty>
    <com.sonyericsson.rebuild.RebuildSettings plugin="rebuild@">
      <autoRebuild>false</autoRebuild>
      <rebuildDisabled>false</rebuildDisabled>
    </com.sonyericsson.rebuild.RebuildSettings>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.StringParameterDefinition>
          <name>cloudsource</name>
          <description>mkcloud alias for repository to be used: develcloud6 or susecloud6</description>
          <defaultValue>susecloud6</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>TESTHEAD</name>
          <description>Use the latest changes from staging, not set by default. Set only when using cloudsource develcloud</description>
          <defaultValue/>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>hw_number</name>
          <description>Use QA hardware, default is qa2 (value 2), other option is qa3 (value 3)</description>
          <defaultValue>2</defaultValue>
        </hudson.model.StringParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
  </properties>
  <scm class="hudson.scm.NullSCM"/>
  <canRoam>true</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers/>
  <concurrentBuild>false</concurrentBuild>
  <axes>
    <hudson.matrix.TextAxis>
      <name>scenario_name</name>
      <values>
        <string>1a</string>
        <string>1b</string>
        <string>2a</string>
        <string>2b</string>
        <string>2c</string>
        <string>6a</string>
      </values>
    </hudson.matrix.TextAxis>
    <hudson.matrix.TextAxis>
      <name>ssl_type</name>
      <values>
        <string>no-ssl</string>
      </values>
    </hudson.matrix.TextAxis>
    <hudson.matrix.LabelAxis>
      <name>label</name>
      <values>
        <string>cloud-trigger</string>
      </values>
    </hudson.matrix.LabelAxis>
  </axes>
  <builders>
    <hudson.plugins.parameterizedtrigger.TriggerBuilder plugin="parameterized-trigger@">
      <configs>
        <hudson.plugins.parameterizedtrigger.BlockableBuildTriggerConfig>
          <configs>
            <hudson.plugins.parameterizedtrigger.PredefinedBuildParameters>
              <properties>cloudsource=$cloudsource
scenario_url=$scenario_url
hw_number=$hw_number
ssl_type=$ssl_type
TESTHEAD=$TESTHEAD</properties>
            </hudson.plugins.parameterizedtrigger.PredefinedBuildParameters>
          </configs>
          <projects>$job_name</projects>
          <condition>ALWAYS</condition>
          <triggerWithNoParameters>false</triggerWithNoParameters>
          <block>
            <buildStepFailureThreshold>
              <name>FAILURE</name>
              <ordinal>2</ordinal>
              <color>RED</color>
              <completeBuild>true</completeBuild>
            </buildStepFailureThreshold>
            <unstableThreshold>
              <name>UNSTABLE</name>
              <ordinal>1</ordinal>
              <color>YELLOW</color>
              <completeBuild>true</completeBuild>
            </unstableThreshold>
            <failureThreshold>
              <name>FAILURE</name>
              <ordinal>2</ordinal>
              <color>RED</color>
              <completeBuild>true</completeBuild>
            </failureThreshold>
          </block>
          <buildAllNodesWithLabel>false</buildAllNodesWithLabel>
        </hudson.plugins.parameterizedtrigger.BlockableBuildTriggerConfig>
      </configs>
    </hudson.plugins.parameterizedtrigger.TriggerBuilder>
  </builders>
  <publishers/>
  <buildWrappers>
    <EnvInjectBuildWrapper plugin="envinject@">
      <info>
        <groovyScriptContent>def github_raw_url = "https://raw.githubusercontent.com/SUSE-Cloud/automation/master/scripts/scenarios/cloud6/qa/"

def scenario_details = [
  "1a": [ file: "qa-scenario-1a-ha-kvm-swift.yaml",     job_name: "cloud-mkphyscloud-qa-scenario-1a" ],
  "1b": [ file: "qa-scenario-1b-ipmi-kvm-xen.yaml",     job_name: "cloud-mkphyscloud-qa-scenario-1b" ],
  "2a": [ file: "qa-scenario-2a-sbd-kvm.yaml",          job_name: "cloud-mkphyscloud-qa-scenario-2a" ],
  "2b": [ file: "qa-scenario-2b-sbd-kvm-vmware.yaml",   job_name: "cloud-mkphyscloud-qa-scenario-2b" ],
  "2c": [ file: "qa-scenario-2c-sbd-kvm.yaml",          job_name: "cloud-mkphyscloud-qa-scenario-2c" ],
  "3a": [ file: "qa-scenario-3a-kvm-hyperv.yaml",          job_name: "cloud-mkphyscloud-qa-scenario-3a" ],
  "6a": [ file: "qa-scenario-6a-ipmi-kvm-docker.yaml",  job_name: "cloud-mkphyscloud-qa-scenario-6a" ]
]

def params = [
  scenario_url: github_raw_url + ssl_type + "/" + scenario_details[scenario_name]["file"],
  job_name: scenario_details[scenario_name]["job_name"]
]

return params
</groovyScriptContent>
        <loadFilesFromMaster>false</loadFilesFromMaster>
      </info>
    </EnvInjectBuildWrapper>
    <org.jenkinsci.plugins.buildnamesetter.BuildNameSetter plugin="build-name-setter@">
      <template>#${BUILD_NUMBER} - $cloudsource - $ssl_type - $scenario_name</template>
    </org.jenkinsci.plugins.buildnamesetter.BuildNameSetter>
  </buildWrappers>
  <executionStrategy class="hudson.matrix.DefaultMatrixExecutionStrategyImpl">
    <runSequentially>true</runSequentially>
    <sorter class="org.jenkinsci.plugin.matrixconfigsorter.LastAxisSorter" plugin="Matrix-sorter-plugin@1.1"/>
  </executionStrategy>
</matrix-project>
